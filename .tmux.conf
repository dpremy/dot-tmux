# some options below are tmux version specific
# while we could detect version and apply only the options
# which are supported, using set with quiet '-q' is easier

# ---------------------
# utf8 for tmux < 2.2
# ---------------------
set -gq utf8                                                # set utf8 global
set-window-option -gq utf8 on                               # set utf8 for each window

# ---------------------
# terminal options
# ---------------------
set -gs default-terminal "screen-256color"                  # default terminal for new windows created in sessions
#set -g terminal-overrides 'xterm*:putty*:colors=256:smcup@:rmcup@'

# determine if we should enable 256-colour support
if "[[ ${TERM} =~ 256color || ${TERM} == fbterm ]]" 'set -g default-terminal screen-256color'

# environment variables to be copied into the session environment when a new session is created or an existing session is attached
# includes TERM variable of terminal emulator
set -g update-environment 'DISPLAY SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY TERM'

# ---------------------
# prefix and bind options
# ---------------------
unbind C-b                                                  # unbind C-b to free it up
set -g prefix `                                             # set ` (tic) as the default prefix key combination

bind ` send-prefix                                          # use send-prefix to pass ` (tic) through to application

set -sg escape-time 1                                       # shorten command delay

set-option -g base-index 1                                  # base index to 1 (default 0)
setw -g pane-base-index 1                                   # base index to 1 (default 0)

set-window-option -g automatic-rename on                    # attempt to rename windows based on command currently running

bind    F               swap-window -t 1                    # use prefix F to make the current window the first window
bind    r  source-file ~/.tmux.conf \; display "Reloaded!"  # set reloading ~/.tmux.conf using PREFIX r
bind    |               split-window -h                     # use prefix | to split window horizontally
bind    -               split-window -v                     # use prefix - to split vertically
bind -r "<"             swap-window -t -1                   # use prefix < to move the window one position to the left
bind -r ">"             swap-window -t +1                   # use prefix > to move the window one position to the right
bind -r prefix Up       select-pane -U                      # prefix arrow key select panes
bind -r prefix Down     select-pane -D                      # prefix arrow key select panes
bind -r prefix Left     select-pane -L                      # prefix arrow key select panes
bind -r prefix Right    select-pane -R                      # prefix arrow key select panes
bind -r prefix M-Up     resize-pane -U 5                    # prefix shift arrows adjust pane size by 5
bind -r prefix M-Down   resize-pane -D 5                    # prefix shift arrows adjust pane size by 5
bind -r prefix M-Left   resize-pane -L 5                    # prefix shift arrows adjust pane size by 5
bind -r prefix M-Right  resize-pane -R 5                    # prefix shift arrows adjust pane size by 5
bind -r prefix C-Up     resize-pane -U                      # prefix ctrl arrows adjust pane size by 1
bind -r prefix C-Down   resize-pane -D                      # prefix ctrl arrows adjust pane size by 1
bind -r prefix C-Left   resize-pane -L                      # prefix ctrl arrows adjust pane size by 1
bind -r prefix C-Right  resize-pane -R                      # prefix ctrl arrows adjust pane size by 1
bind           v        select-layout even-vertical         # prefix v for even-vertical arrangement
bind           h        select-layout even-horizontal       # prefix h for even-horizontal arrangement
bind           C-s      set-window-option synchronize-panes # prefix ctrl s to synchronize all panes input

# ---------------------
# mouse control for tmux < 2.1
# ---------------------
set -gq mouse on                                            # turn on mouse for tmux > 2.1
setw -gq mode-mouse on                                      # turn on mouse for tmux < 2.1
set -gq mouse-select-pane off                               # disable mouse from changing panes for tmux < 2.1
set -gq mouse-resize-pane on                                # allow panes to be re-sized by dragging borders for tmux < 2.1
set -gq mouse-select-window on                              # allow mouse to change windows using window name in status line for tmux < 2.1

# ---------------------
# copy and paste
# ---------------------
setw -g mode-keys vi                                        # use vim keybindings in copy mode

# ----------------------
# colors
# ----------------------
# set pane colors - hilight the active pane
set-option -g pane-border-fg colour235
set-option -g pane-active-border-fg colour33

# colorize messages in the command line
set-option -g message-bg black
set-option -g message-fg brightred

# ----------------------
# status bar
# -----------------------
set-option -g status on                                     # turn the status bar on
set -gq status-utf8 on                                      # set utf-8 for the status bar, required for tmux < 2.2
set -g status-interval 10                                   # set update frequency (default 15 seconds)
set -g status-justify centre                                # center window list for clarity

setw -g monitor-activity on                                 # enable monitoring of activity in windows
set -g visual-activity on                                   # display status line message of activity in other windows

# set color for status bar
set-option -g status-bg colour235
set-option -g status-fg yellow
set-option -g status-attr dim

# set window list colors - red for active and cyan for inactive
set-window-option -g window-status-fg brightblue
set-window-option -g window-status-bg colour236
set-window-option -g window-status-attr dim

set-window-option -g window-status-current-fg brightred
set-window-option -g window-status-current-bg colour236
set-window-option -g window-status-current-attr bright

# set statusbar left length
set -g status-left-length 85

# show cpu (plugin), pane title, session name, window & pane number, date and time on right side of status bar
set -g status-right-length 80
set -g status-right "#{cpu_percentage} : #[fg=cyan]#{=15:pane_title} : #[fg=blue]#S #I:#P #[fg=yellow]: %d %b %Y #[fg=green]: %l:%M %p"

set-window-option -g aggressive-resize on                   # if using a grouped session or multi-monitor setup turn on the aggressive re-sizing for panes

set -g history-limit 30000                                  # set scrollback history to 30000 (30k)

# -----------------------
# tmux plugins
# -----------------------
# list of plugins (use prefix + I to install, prefix + U to update)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'seebi/tmux-colors-solarized'

# initialize tpm (keep this line at the very bottom of tmux.conf)
if "test ! -d ~/.tmux/plugins/tpm" \
  "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm'"

if "test ! -d ~/.tmux/plugins/tmux-sensible" \
  "run 'git clone https://github.com/tmux-plugins/tmux-sensible ~/.tmux/plugins/tmux-sensible'"

if "test ! -d ~/.tmux/plugins/tmux-cpu" \
  "run 'git clone https://github.com/tmux-plugins/tmux-cpu ~/.tmux/plugins/tmux-cpu'"

if "test ! -d ~/.tmux/plugins/tmux-sessionist" \
  "run 'git clone https://github.com/tmux-plugins/tmux-sessionist ~/.tmux/plugins/tmux-sessionist'"

if "test ! -d ~/.tmux/plugins/tmux-colors-solarized" \
  "run 'git clone https://github.com/seebi/tmux-colors-solarized ~/.tmux/plugins/tmux-colors-solarized'"

run '~/.tmux/plugins/tpm/tpm'
